{
    "poolsnp": {
        "options": {
            "account": "EcoGenetics",
            "cores": 20,
            "memory": "160g",
            "walltime": "60:00:00"
        },
        "inputs": {
            "mpileup": "/faststorage/project/EcoGenetics/BACKUP/population_genetics/collembola/Orchesella_cincta/OrcCin/OrcCin.mpileup",
            "max_cov": "/faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/OrcCin-cov-0.98.txt"
        },
        "outputs": {
            "vcf": "/faststorage/project/EcoGenetics/BACKUP/population_genetics/collembola/Orchesella_cincta/OrcCin/OrcCin.vcf.gz"
        },
        "spec": "
        # Sources environment
        if [ \"$USER\" == \"jepe\" ]; then
            source /home/\"$USER\"/.bashrc
            source activate vcf
        fi
        
        echo \"START: $(date)\"
        echo \"JobID: $SLURM_JOBID\"
        
        [ -d /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp ] || mkdir -p /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp
        
        headerfile=/faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/header.txt
        echo -e \"##fileformat=VCFv4.2\" > \"$headerfile\"
        echo -e \"##fileDate=$(date +%d'/'%m'/'%y)\" >> \"$headerfile\"
        echo -e \"##Source=PoolSnp-1.05\" >> \"$headerfile\"
        echo -e \"##Parameters=<ID=MinCov,Number=2,Type=Integer,Description=\\\"Minimum coverage per sample\\\">\" >> \"$headerfile\"
        echo -e \"##Parameters=<ID=MaxCov,Number=/faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/OrcCin-cov-0.98.txt,Type=Integer,Description=\\\"Maximum chromosome- and sample-specific maximum coverage; Either a precomputed file or the maximum percentile cutoff, eg. 0.95 to consider only reads within the 95% coverage percentile\\\">\" >> \"$headerfile\"
        echo -e \"##Parameters=<ID=MinCount,Number=2,Type=Integer,Description=\\\"Minimum alternative allele count across all samples pooled\\\">\" >> \"$headerfile\"
        echo -e \"##Parameters=<ID=MinFreq,Number=0,Type=Float,Description=\\\"Minimum alternative allele frequency across all samples pooled\\\">\" >> \"$headerfile\"
        echo -e \"##Parameters=<ID=MaximumMissingFraction,Number=0.001,Type=Float,Description=\\\"Maximum fraction of samples allowed that are not fullfilling all parameters\\\">\" >> \"$headerfile\"
        echo -e \"##Parameters=<ID=BaseQual,Number=15,Type=Integer,Description=\\\"Minimum PHRED scaled base quality\\\">\" >> \"$headerfile\"
        echo -e \"##Reference=/faststorage/project/EcoGenetics/BACKUP/reference_genomes/Orchesella_cincta/GCA_001718145.1_ASM171814v1_genomic.fna\" >> \"$headerfile\"
        echo -e \"##INFO=<ID=ADP,Number=1,Type=Integer,Description=\\\"Average per-sample depth of bases with Phred score >=15\\\">\" >> \"$headerfile\"
        echo -e \"##INFO=<ID=NC,Number=1,Type=Integer,Description=\\\"Number of samples not called\\\">\" >> \"$headerfile\"
        echo -e \"##FORMAT=<ID=GT,Number=1,Type=String,Description=\\\"Genotype\\\">\" >> \"$headerfile\"
        echo -e \"##FORMAT=<ID=RD,Number=1,Type=Integer,Description=\\\"Reference Counts\\\">\" >> \"$headerfile\"
        echo -e \"##FORMAT=<ID=AD,Number=1,Type=Integer,Description=\\\"Alternative Counts\\\">\" >> \"$headerfile\"
        echo -e \"##FORMAT=<ID=DP,Number=1,Type=Integer,Description=\\\"Total Depth\\\">\" >> \"$headerfile\"
        echo -e \"##FORMAT=<ID=FREQ,Number=1,Type=Float,Description=\\\"Variant allele frequency\\\">\" >> \"$headerfile\"
        echo -e \"#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\tFORMAT\tOrcCin_aeRoe-C182\tOrcCin_DSJ-C233\tOrcCin_FaaJ-C6\tOrcCin_JHJ-C222\tOrcCin_KLJ-C49\tOrcCin_LEJ-C63\tOrcCin_MSJ-C87\tOrcCin_NYS-F-C25\tOrcCin_NYS-F\tOrcCin_RYJ\" >> \"$headerfile\"
        
        parallel \
            -k \
            -j 20 \
            --pipepart \
            --no-notice \
            -a /faststorage/project/EcoGenetics/BACKUP/population_genetics/collembola/Orchesella_cincta/OrcCin/OrcCin.mpileup \
            --cat python /faststorage/project/EcoGenetics/people/Jeppe_Bayer/scripts/gwf/03_initial_analysis_files/workflow_source/PoolSNP/scripts/PoolSnp.py \
            --mpileup {} \
            --min-cov 2 \
            --max-cov /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/OrcCin-cov-0.98.txt \
            --min-freq 0 \
            --miss-frac 0.001 \
            --min-count 2 \
            --base-quality 15 \
            --allsites True \
            > /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/SNPs.prog.txt
        
        mv /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/SNPs.prog.txt /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/SNPs.txt
        
        cat /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/header.txt /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/SNPs.txt | gzip > /faststorage/project/EcoGenetics/BACKUP/population_genetics/collembola/Orchesella_cincta/OrcCin/OrcCin.vcf.gz\n\n    rm -f /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/header.txt\n    rm -f /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/SNPs.prog.txt\n    rm -f /faststorage/project/EcoGenetics/people/Jeppe_Bayer/steps/03_initial_analysis_files/Orchesella_cincta/tmp/SNPs.txt
        
        echo \"END: $(date)\"
        echo \"$(jobinfo \"$SLURM_JOBID\")\"
        ",
        "dependencies": [
            "concatenate_coverage",
            "concat_mpileup"
        ],
        "dependents": []
    }
}
